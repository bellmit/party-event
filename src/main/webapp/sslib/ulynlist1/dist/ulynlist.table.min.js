/*! ulynlist-js-5.0.0(2015-02-12) */
!function(a){"function"==typeof define&&define.amd?define("ulynlist.table",["jquery","artTemplate"],a):a(jQuery,template)}(function(a,b){"use strict";function c(g,h,i){var j=b.compile(g);h.tableColumn.loadFilter(h.data),h.md5UniqueID&&m(h.data);var k={currentObj:i,list:h.data,tableColumn:h.tableColumn,startRowNum:h.startRowNum,extra:h.extra};if(h.fullRow){var l=h.fullRow-h.data.length;if(l>0)for(var n=0;l>n;n++)k.list.push(null)}h.tableColumn.rememberCheckbox||a(i).data(r,{});var o=j(k);a(i).html(o),a(".sortable",a(i)).click(function(){var b=a(this).attr("field"),d="desc";a(this).hasClass("asc")?(a(this).removeClass("asc"),a(this).addClass("desc"),d="desc"):a(this).hasClass("desc")&&(a(this).removeClass("desc"),a(this).addClass("asc"),d="asc");var e=h.tableColumn.columns,f=null;if(e)for(var j=0,k=e.length;k>j;j++)e[j].field==b?(e[j].sortType=d,f=e[j]):e[j].sortType=null;h.sortSelf?(f&&(h.data=h.data.sort(function(a,c){return"asc"==d?f.customOrderFunc(a[b],c[b]):0-f.customOrderFunc(a[b],c[b])})),c(g,h,i)):a(i).trigger("clickSort",[b,d])});var p=h.checkAllCheckboxId?a("#"+h.checkAllCheckboxId):a(".th_checkbox",a(i));p.click(function(){try{var b=a(this).prop("checked");a("input[class=td_checkbox]",a(i)).each(function(){b?a(this).is(":checked")||(a(this).prop("checked",b),e(a(i),a(this))):a(this).is(":checked")&&(a(this).prop("checked",b),f(a(i),a(this)))})}catch(c){a("input[class=td_checkbox]",a(i)).each(a(this).is(":checked")?function(){a(this).attr("checked",!0),e(a(i),a(this))}:function(){a(this).removeAttr("checked"),f(a(i),a(this))})}}),a("input[class=td_checkbox]",a(i)).click(function(){a(this).is(":checked")?e(a(i),a(this)):f(a(i),a(this)),d(i,p)}),d(i,p),a(i).data(s,h),h.afterTableRender&&h.afterTableRender(a(i),h)}function d(b,c){var d=a(".td_checkbox",a(b)),e=!0;if(0===d.length)e=!1;else for(var f=0;f<d.length;f++){var g=d[f];if(!a(g).is(":checked")){e=!1;break}}if(e){if(!c.is(":checked"))try{c.prop("checked",!0)}catch(h){c.attr("checked",!0)}}else if(c.is(":checked"))try{c.prop("checked",!1)}catch(h){c.removeAttr("checked")}}function e(b,c){var d=b.data(r);d||(d={},b.data(r,d));var e=b.data(s),f=c.val(),g=c.attr("name").replace("ck_","");a.each(e.data,function(a,b){if(b)if(e.md5UniqueID){if(b._md5UniqueID==f)return d[b._md5UniqueID]=b,!1}else if(b[g]==f)return d[b[g]]=b,!1})}function f(a,b){var c=a.data(r);if(!c)return void q("checkbox缓存不存在耶...不科学啊！！");var d=b.val();delete c[d]}function g(c,d,e,f){if(!c)return"&nbsp;";if(d.checkbox){var g="",l=c._md5UniqueID||c[d.checkbox],m=e?a(e).data(r):{};if(m||(m={},a(e).data(r,m)),m[l])g="checked";else if(d.field){var n=c[d.field];n&&(g="checked",m[l]=c)}return' <input type="checkbox" name="ck_'+(d.checkbox||"md5UniqueID")+'" class="td_checkbox" value="'+l+'" '+g+">"}if(d.bodyContent||!d.field)return k(c,d,f);var o="";return o=d.tableValue?j(c,d):d.tableTransFunc&&a.isFunction(d.tableTransFunc)?i(c,d,f):"toDisDate"===d.trans?h(c,d):c[d.field],d.escapeHTML&&(o=b.helpers.$escape(o)),o}function h(b,c){var d=b[c.field];return a.fn.ulynlistTable.toDisplayStoreDateStr(d,c.dateType)}function i(a,b,c){var d=b.tableTransFunc,e=a[b.field];return d(e,a,c)}function j(b,c){var d=b[c.field];if(!a.isArray(c.tableValue)){var e=c.tableValue;return e[d]}for(var f=0;f<c.tableValue.length;f++){var g=c.tableValue[f];if(g.code===d)return g.value}return d}function k(b,c,d){var e=c.bodyContent;if(!e)return e;var f=/\[(\$)?\w+\]/g,g=e.match(f);if(g){g.sort(),g=a.unique(g);for(var h=0;h<g.length;h++){var i=g[h].substring(1,g[h].length-1);e=b.hasOwnProperty(i)?e.replace(new RegExp("\\["+i+"\\]","g"),b[i]):"$rowIdx"==i?e.replace(new RegExp("\\[\\$rowIdx\\]","g"),d):e.replace(new RegExp("\\["+i+"\\]","g"),"")}}return e}function l(b){b.tableColumn||alert("请先定义tableColumn参数！");var c=b.tableColumn.columns;if(c)if(a.isArray(c)){for(var d=0,e=c.length;e>d;d++){var f=c[d],g=f.className;!f.field||g&&-1!=g.indexOf("unSortable")||(g?-1==g.indexOf("sortable")&&(f.className="sortable "+f.className):f.className="sortable"),f.checkbox&&(g?-1!=g.indexOf("sortable")&&(f.className=g.replace("sortable","unSortable")):f.className="unSortable",f.width=40,f.checkAllCheckboxId&&(b.checkAllCheckboxId=f.checkAllCheckboxId)),"number"===f.customOrderFunc?f.customOrderFunc=function(a,b){return t(Number(a),Number(b))}:"function"!=typeof f.customOrderFunc&&(f.customOrderFunc=t)}p(b.tableColumn.columns,function(a){return a.show===!1})}else alert("参数定义错误，需要数组，但opts.tableColumn.columns 是 "+c.constructor+"！");else q("请注意，缺少opts.tableColumn.columns的定义,模版是否支持~~")}function m(b){a.each(b,function(a,b){b._md5UniqueID=n(b)})}function n(b){if(!b)return"";var c=[];for(var d in b)"_md5UniqueID"!==d&&c.push(b[d]);var e=c.join("");return a.fn.ulynlistTable.md5(e)}function o(a,b){return isNaN(b)||b>a.length?!1:void a.splice(b,1)}function p(a,b){if(a&&a.length>0)for(var c=0;b(a[c],c)&&(o(a,c),c<a.length)||(c++,c<a.length););}function q(a){window.console&&window.console.log&&window.console.log(a)}b=b||window.template;var r="ulynlist_checked_cache",s="ulynlist_table_opts";a.fn.ulynlistTable=function(b){var d=a.extend(!0,{},a.fn.ulynlistTable.defaults,b);return this.each(function(){l(d),d._notRemoveData||a(this).removeData();var b=this,e=d.tableTpl+"-tableTpl",f=!1;if(0===a("#"+e).length){f=!0;var g=d.tablePath+"/"+d.tableTpl+"/style.css",h=document.createElement("link");h.setAttribute("type","text/css"),h.setAttribute("rel","stylesheet"),h.setAttribute("href",g),a("head")[0].appendChild(h)}else a("#"+e).text()?c(a("#"+e).text(),d,b):(e=d.tableTpl+"-tableTpl"+(new Date).getTime()+Math.round(1e4*Math.random()),f=!0);if(f){a("body").append("<div id='"+e+"' style='display: none;'></div>");var i=d.tablePath+"/"+d.tableTpl+"/table.tpl";a.get(i,function(f,g){"success"==g?(a("#"+e).text(f),c(f,d,b)):alert("页面模版加载出错！")},"text")}})},a.fn.ulynlistTable.setData=function(b,c,d){return a.isArray(c)?(d=d||b.data(s),void(d?(d.data=c,d._notRemoveData=!0,a(b).ulynlistTable(d)):q("设值渲染setData需要先执行初始化调用或者传入opts!!!"))):void q("$.fn.ulynlistTable.setData设值错误，data不是对象数组！！")};var t=function(a,b){return a>b?1:b>a?-1:0};a.fn.ulynlistTable.toDisplayStoreDateStr=function(a,b){if(!a||a.length<6||a.length>14)return a;var c=[];switch(b){case"HY":c=["-","-"," ",":",":"];break;case"DOT":c=[".","."," ",":",":"];break;case"CN":c=["年","月","日 ",":",":"];break;default:c=["-","-"," ",":",":"]}try{switch(a=a.replace(/ /g,"").replace(/-/g,"").replace(/:/g,""),a.length){case 6:a=a.substr(0,4)+c[0]+a.substr(4,2);break;case 8:a=a.substr(0,4)+c[0]+a.substr(4,2)+c[1]+a.substr(6,2);break;case 10:a=a.substr(0,4)+c[0]+a.substr(4,2)+c[1]+a.substr(6,2)+c[2]+a.substr(8,2);break;case 12:a=a.substr(0,4)+c[0]+a.substr(4,2)+c[1]+a.substr(6,2)+c[2]+a.substr(8,2)+c[3]+a.substr(10,2);break;case 14:a=a.substr(0,4)+c[0]+a.substr(4,2)+c[1]+a.substr(6,2)+c[2]+a.substr(8,2)+c[3]+a.substr(10,2)+c[4]+a.substr(12,2);break;default:return a}return a}catch(d){return a}},a.fn.ulynlistTable.checkbox=function(b,c){var d=b.data(r)||{},e=[];if(c){if(c===!0)for(var f in d)d.hasOwnProperty(f)&&e.push(d[f]);else if(a.isArray(c))for(var g in d)if(d.hasOwnProperty(g)){for(var h={},i=d[g],j=0,k=c.length;k>j;j++){var l=c[j];h[l]=i[l]}e.push(h)}}else for(var m in d)d.hasOwnProperty(m)&&e.push(m);return e},a.fn.ulynlistTable.clearCheckboxCache=function(a){a.data(r,[])},a.fn.ulynlistTable.loadDetail=function(b,c){var d=a.extend({text:"",url:"",type:"table",style:"",toggle:!1,colspan:1,onLoadError:function(){alert("加载失败！")}},c),e=a(b).next();if(e.hasClass("detail-list"))return void(d.toggle?(e.siblings().each(function(){a(this).hasClass("hasOpened")&&a(this).hide().removeClass("hasOpened")}),e.hasClass("hasOpened")?e.hide().removeClass("hasOpened"):e.show().addClass("hasOpened")):e.toggle());if(d.toggle&&e.siblings().each(function(){a(this).hasClass("hasOpened")&&a(this).hide().removeClass("hasOpened")}),d.setText);else if("table"==d.type)e=a("<tr class='detail-list hasOpened'><td colspan='"+d.colspan+"' style='"+d.style+"'><div style='text-align: center;width: 100%'>加载中...</div></td></tr>"),a(b).after(e);else{if("div"!=d.type)return void alert("目前只支持type = table或者自定义setText");e=a("<div class='detail-list hasOpened' style='"+d.style+"'><div style='text-align: center;width: 100%'>加载中...</div></div>"),a(b).after(e)}if(d.url&&!a(b).hasClass("hasLoaded")){var f=!1;if(a.ajax({type:"get",async:!1,url:d.url,success:function(c){d.text=c,f=!0,a(b).addClass("hasLoaded")},error:d.onLoadError}),!f)return}d.setText?d.setText(d.text):"table"==d.type?e.find("td").html(d.text):"div"==d.type&&e.html(d.text)},a.fn.ulynlistTable.version="5.0.0",a.fn.ulynlistTable.defaults={tablePath:"table",tableTpl:"default",tableColumn:{title:"",rowStyler:function(){},loadFilter:function(){},rememberCheckbox:!1,columns:[],rownumbers:!1,rownumbersTrans:function(a){return a},rownumberslabel:"序号"},data:[],md5UniqueID:!1,afterTableRender:function(){},sortSelf:!0,startRowNum:0,extra:{},fullRow:0},function(b){b.helper("$outputLabel",function(a){return a.checkbox?a.checkAllCheckboxId?a.label:'<input type="checkbox" class="th_checkbox" name="ck_'+a.checkbox+'">':a.label}),b.helper("$outputContent",function(a,b,c,d){return g(a,b,c,d)}),b.helper("$outputContentForTitle",function(a,b,c,d){if(!a)return null;if(!b.field||b.checkbox)return"";var e=g(a,b,c,d);if(!e)return"";if("string"!=typeof e)return e+"";var f=/<[^>]*?>(.*?)/g;return e.replace(f,"").replace(/\"/g,"&quot;")}),b.helper("$doFunc",function(b){if(a.isFunction(b)){var c=[];if(arguments.length>1)for(var d=1;d<arguments.length;d++)c.push(arguments[d]);return b.apply(this,c)}return""}),b.helper("$console",function(a){q(a)})}(b),function(a){var b=function(a,b){return a<<b|a>>>32-b},c=function(a,b){var c,d,e,f,g;return e=2147483648&a,f=2147483648&b,c=1073741824&a,d=1073741824&b,g=(1073741823&a)+(1073741823&b),c&d?2147483648^g^e^f:c|d?1073741824&g?3221225472^g^e^f:1073741824^g^e^f:g^e^f},d=function(a,b,c){return a&b|~a&c},e=function(a,b,c){return a&c|b&~c},f=function(a,b,c){return a^b^c},g=function(a,b,c){return b^(a|~c)},h=function(a,e,f,g,h,i,j){return a=c(a,c(c(d(e,f,g),h),j)),c(b(a,i),e)},i=function(a,d,f,g,h,i,j){return a=c(a,c(c(e(d,f,g),h),j)),c(b(a,i),d)},j=function(a,d,e,g,h,i,j){return a=c(a,c(c(f(d,e,g),h),j)),c(b(a,i),d)},k=function(a,d,e,f,h,i,j){return a=c(a,c(c(g(d,e,f),h),j)),c(b(a,i),d)},l=function(a){for(var b,c=a.length,d=c+8,e=(d-d%64)/64,f=16*(e+1),g=Array(f-1),h=0,i=0;c>i;)b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|a.charCodeAt(i)<<h,i++;return b=(i-i%4)/4,h=i%4*8,g[b]=g[b]|128<<h,g[f-2]=c<<3,g[f-1]=c>>>29,g},m=function(a){var b,c,d="",e="";for(c=0;3>=c;c++)b=a>>>8*c&255,e="0"+b.toString(16),d+=e.substr(e.length-2,2);return d},n=function(a){a=a.replace(/\x0d\x0a/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},o=function(a){var b,d,e,f,g,o,p,q,r,s=Array(),t=7,u=12,v=17,w=22,x=5,y=9,z=14,A=20,B=4,C=11,D=16,E=23,F=6,G=10,H=15,I=21;for(a=n(a),s=l(a),o=1732584193,p=4023233417,q=2562383102,r=271733878,b=0;b<s.length;b+=16)d=o,e=p,f=q,g=r,o=h(o,p,q,r,s[b+0],t,3614090360),r=h(r,o,p,q,s[b+1],u,3905402710),q=h(q,r,o,p,s[b+2],v,606105819),p=h(p,q,r,o,s[b+3],w,3250441966),o=h(o,p,q,r,s[b+4],t,4118548399),r=h(r,o,p,q,s[b+5],u,1200080426),q=h(q,r,o,p,s[b+6],v,2821735955),p=h(p,q,r,o,s[b+7],w,4249261313),o=h(o,p,q,r,s[b+8],t,1770035416),r=h(r,o,p,q,s[b+9],u,2336552879),q=h(q,r,o,p,s[b+10],v,4294925233),p=h(p,q,r,o,s[b+11],w,2304563134),o=h(o,p,q,r,s[b+12],t,1804603682),r=h(r,o,p,q,s[b+13],u,4254626195),q=h(q,r,o,p,s[b+14],v,2792965006),p=h(p,q,r,o,s[b+15],w,1236535329),o=i(o,p,q,r,s[b+1],x,4129170786),r=i(r,o,p,q,s[b+6],y,3225465664),q=i(q,r,o,p,s[b+11],z,643717713),p=i(p,q,r,o,s[b+0],A,3921069994),o=i(o,p,q,r,s[b+5],x,3593408605),r=i(r,o,p,q,s[b+10],y,38016083),q=i(q,r,o,p,s[b+15],z,3634488961),p=i(p,q,r,o,s[b+4],A,3889429448),o=i(o,p,q,r,s[b+9],x,568446438),r=i(r,o,p,q,s[b+14],y,3275163606),q=i(q,r,o,p,s[b+3],z,4107603335),p=i(p,q,r,o,s[b+8],A,1163531501),o=i(o,p,q,r,s[b+13],x,2850285829),r=i(r,o,p,q,s[b+2],y,4243563512),q=i(q,r,o,p,s[b+7],z,1735328473),p=i(p,q,r,o,s[b+12],A,2368359562),o=j(o,p,q,r,s[b+5],B,4294588738),r=j(r,o,p,q,s[b+8],C,2272392833),q=j(q,r,o,p,s[b+11],D,1839030562),p=j(p,q,r,o,s[b+14],E,4259657740),o=j(o,p,q,r,s[b+1],B,2763975236),r=j(r,o,p,q,s[b+4],C,1272893353),q=j(q,r,o,p,s[b+7],D,4139469664),p=j(p,q,r,o,s[b+10],E,3200236656),o=j(o,p,q,r,s[b+13],B,681279174),r=j(r,o,p,q,s[b+0],C,3936430074),q=j(q,r,o,p,s[b+3],D,3572445317),p=j(p,q,r,o,s[b+6],E,76029189),o=j(o,p,q,r,s[b+9],B,3654602809),r=j(r,o,p,q,s[b+12],C,3873151461),q=j(q,r,o,p,s[b+15],D,530742520),p=j(p,q,r,o,s[b+2],E,3299628645),o=k(o,p,q,r,s[b+0],F,4096336452),r=k(r,o,p,q,s[b+7],G,1126891415),q=k(q,r,o,p,s[b+14],H,2878612391),p=k(p,q,r,o,s[b+5],I,4237533241),o=k(o,p,q,r,s[b+12],F,1700485571),r=k(r,o,p,q,s[b+3],G,2399980690),q=k(q,r,o,p,s[b+10],H,4293915773),p=k(p,q,r,o,s[b+1],I,2240044497),o=k(o,p,q,r,s[b+8],F,1873313359),r=k(r,o,p,q,s[b+15],G,4264355552),q=k(q,r,o,p,s[b+6],H,2734768916),p=k(p,q,r,o,s[b+13],I,1309151649),o=k(o,p,q,r,s[b+4],F,4149444226),r=k(r,o,p,q,s[b+11],G,3174756917),q=k(q,r,o,p,s[b+2],H,718787259),p=k(p,q,r,o,s[b+9],I,3951481745),o=c(o,d),p=c(p,e),q=c(q,f),r=c(r,g);var J=m(o)+m(p)+m(q)+m(r);return J.toLowerCase()};a.md5=o}(a.fn.ulynlistTable)});