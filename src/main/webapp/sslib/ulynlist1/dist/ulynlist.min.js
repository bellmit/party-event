/*! ulynlist-js-5.0.0(2015-02-12) */
!function(a){"function"==typeof define&&define.amd?define("ulynlist",["jquery","ulynlist.table","ulynlist.pagebar"],a):a(jQuery)}(function(a){"use strict";function b(b,d){return function(b,d){var e=a.extend(!0,{},a.fn.ulynlist.defaults,d);e.tablePath||(e.tablePath=e.basePath+"/table"),e.usePageBar&&(e.sortSelf=!1),e.pageBarPath||(e.pageBarPath=e.basePath+"/pagebar"),e.requestData.linesPerPage||(e.requestData.linesPerPage=10),e.requestData.currentPage||(e.requestData.currentPage=1),e.beforeLoad();var f=e.afterTableRender;return e.afterTableRender=function(a,b){f(a,b),b.afterLoad()},a(b).unbind("clickSort").bind("clickSort",function(a,d,f){e.requestData.sortField=d,e.requestData.sortType=f;var g=e.tableColumn.columns;for(var h in g)g[h].field==d?(g[h].sortType=f,g[h].orderColumn&&(e.requestData.sortField=g[h].orderColumn)):g[h].sortType=null;return e._mainObj?void e._mainObj.trigger("clickSort",[d,f]):void c(e,b)}),a("#"+e.pageBarId).unbind("clickPage").bind("clickPage",function(a,d){return e.requestData.currentPage=Number(d),e._mainObj?void e._mainPageBar.trigger("clickPage",[d]):void c(e,b)}),a("#"+e.pageBarId).unbind("setLinesPerPage").bind("setLinesPerPage",function(a,d){return e.requestData.linesPerPage=Number(d),e.requestData.currentPage=1,e._mainObj?void e._mainPageBar.trigger("setLinesPerPage",[d]):void c(e,b)}),a(b).unbind("refresh").bind("refresh",function(a,d){return e._mainObj?void e._mainPageBar.trigger("refresh",[d]):void c(e,b,d)}),e}(b,d)}function c(b,c,g){b.customData?a.isArray(b.customData)?(d(c,b,g),f(b,c)):i("你是在坑我吗?customData居然不给我传数组！！！还要我显示???"):b.customAjax(b.requestData,function(a){e(c,b,a,g)&&f(b,c)},b)}function d(b,c,d){if(c.usePageBar){if(c.sortSelf=!1,c.requestData.sortField){var e=c.requestData.sortField,f=c.requestData.sortType,g=c.tableColumn.columns;if(g){for(var h=null,i=0,j=g.length;j>i;i++)g[i].field==e?(g[i].sortType=f,h=g[i]):g[i].sortType=null;h&&("number"===h.customOrderFunc?h.customOrderFunc=function(a,b){return k(Number(a),Number(b))}:"function"!=typeof h.customOrderFunc&&(h.customOrderFunc=k),c.data=c.data.sort(function(a,b){return"asc"==f?h.customOrderFunc(a[e],b[e]):0-h.customOrderFunc(a[e],b[e])}))}}c.currentPage=c.requestData.currentPage?Number(c.requestData.currentPage):1,c.totalNum=c.customData.length,c.linesPerPage=c.requestData.linesPerPage?Number(c.requestData.linesPerPage):10,c.totalPage=Math.ceil(Number(c.totalNum)/Number(c.linesPerPage)),c.currentPage>c.totalPage&&(c.currentPage=c.totalPage);var l=(c.currentPage-1)*c.linesPerPage,m=l+c.linesPerPage-1;for(m>=c.totalNum&&(m=c.totalNum-1),c.data=[];m>=l;l++)c.data.push(c.customData[l]);c.isFullRow&&(c.fullRow=c.linesPerPage),d?a(b).ulynlistTable(c):a.fn.ulynlistTable.setData(b,c.data),a("#"+c.pageBarId).ulynlistPagination(c)}else c.data=c.customData,d?a(b).ulynlistTable(c):a.fn.ulynlistTable.setData(b,c.data)}function e(b,c,d,e){return d.status?(c.data=d.data.list,c.usePageBar&&(c.currentPage=d.data.currentPage||c.requestData.currentPage||1,c.totalNum=d.data.totalNum,c.linesPerPage=d.data.linesPerPage||c.requestData.linesPerPage||10,a("#"+c.pageBarId).ulynlistPagination(c)),c.isFullRow&&(c.fullRow=c.linesPerPage),e?a(b).ulynlistTable(c):a.fn.ulynlistTable.setData(b,c.data),!0):(c.errorLoad(d.msg),c.afterLoad(),!1)}function f(b,c){var d=a(c)[0].combines;if(d)for(var e=b.data,f={currentPage:b.currentPage,totalNum:b.totalNum},g=0;g<d.length;g++)a.fn.ulynlist.setData(a(d[g].obj),e,f,d[g].opts)}function g(a){var b=[];if("string"==typeof a)return'"'+a.replace(/(\\|\")/g,"\\$1").replace(/\n|\r|\t/g,function(){var a=arguments[0];return"\n"==a?"\\n":"\r"==a?"\\r":"	"==a?"\\t":""})+'"';if("undefined"==typeof a)return"undefined";if("object"==typeof a){if(null===a)return"null";if(a.sort){for(var c=0;c<a.length;c++)b.push(g(a[c]));b="["+b.join()+"]"}else{for(var d in a)b.push('"'+d+'":'+g(a[d]));b="{"+b.join()+"}"}return b}return a.toString()}function h(b){var c={},d=a(b).serializeArray();return a.each(d,function(){c[this.name]?(c[this.name].push||(c[this.name]=[c[this.name]]),c[this.name].push(this.value||"")):c[this.name]=this.value||""}),c}function i(a){window.console&&window.console.log&&window.console.log(a)}var j="ulynlist_table_opts",k=function(a,b){return a>b?1:b>a?-1:0};a.fn.ulynlist=function(d){return this.each(function(){var e=a(this),f=b(e,d);c(f,e,!0)})},a.fn.ulynlist.combine=function(d){var e=d.shift(),f=e.obj,g=e.opts;a(f).length>0&&(a(f)[0].combines=d),g=b(f,g);for(var h=a("#"+g.pageBarId),i=0,j=d.length;j>i;i++){var k=d[i],l=k.obj,m=k.opts;m.requestData=g.requestData,m._mainObj=f,m._mainPageBar=h,k.opts=b(l,m)}c(g,f,!0)},a.fn.ulynlist.getData=function(b){var c=a(b).data(j);if(c){var d=a.extend({},c.data);return d}return{}},a.fn.ulynlist.setData=function(b,c,d,e){e=e||a(b).data(j),e?(d||(d={currentPage:c.currentPage||e.requestData.currentPage||1,totalNum:c.totalNum||0},c=c.list),a.fn.ulynlistTable.setData(b,c,e),e.usePageBar&&(e.currentPage=d.currentPage,e.totalNum=d.totalNum,e.linesPerPage=e.linesPerPage||e.requestData.linesPerPage||10,a("#"+e.pageBarId).ulynlistPagination(e))):i("设值渲染setData需要先执行初始化调用或者传入opts!!!")},a.fn.ulynlist.setRequestData=function(b,d){var e=a(b).data(j);e?(!d.hasOwnProperty("listSql")&&e.requestData.hasOwnProperty("listSql")&&(d.listSql=e.requestData.listSql),!d.hasOwnProperty("linesPerPage")&&e.requestData.hasOwnProperty("linesPerPage")&&(d.linesPerPage=e.requestData.linesPerPage),!d.hasOwnProperty("currentPage")&&e.requestData.hasOwnProperty("currentPage")&&(d.currentPage=e.requestData.currentPage),e.requestData=d,c(e,b,!0)):i("setRequestData需要先执行初始化调用!!!")},a.fn.ulynlist.queryForm=function(b,c,d,e){a.fn.ulynlistTable.clearCheckboxCache(b);var f=a.extend(!0,{},a.fn.ulynlist.defaults,d);f.requestData=a.extend(f.requestData,h(a(c))),e&&e(f.requestData),a(b).ulynlist(f)},a.fn.ulynlist.refresh=function(b,c){a(b).trigger("refresh",[c])},a.fn.ulynlist.getCurrentParams=function(b){var c=a(b).data(j);if(c){var d=a.extend({},c.requestData);return d}return{}},a.fn.ulynlist.exportQuery=function(b,c,d,e,f){var h=a.fn.ulynlist.getCurrentParams(a(b));f||(f="excel"),e||(e=""),h.ulynExportType=f,h.ulynExportColumn=g(c),h.ulynExportFileName=e,a("#ulynlistDyForm").length>0&&a("#ulynlistDyForm").remove();var i=a("<form id='ulynlistDyForm'></form>");i.attr("action",d),i.attr("method","post");for(var j in h){var k=a("<input type='hidden' name='"+j+"' />");k.attr("value",h[j]),i.append(k)}i.css("display","none"),i.appendTo("body"),i.submit()},a.fn.ulynlist.checkbox=function(){return a.fn.ulynlistTable.checkbox.apply(this,arguments)},a.fn.ulynlist.loadDetail=function(){return a.fn.ulynlistTable.loadDetail.apply(this,arguments)},a.fn.ulynlist.globalSetup=function(b){a.extend(!0,this.defaults,b)},a.fn.ulynlist.version="5.0.0",a.fn.ulynlist.defaults={basePath:"ulynlist",tablePath:"",pageBarPath:"",tableTpl:"default",pageBarTpl:"default",url:"ulynlist.do",pageBarId:"ulyn-pageBar-id",usePageBar:!0,tableColumn:{},requestData:{listSql:"",linesPerPage:10,currentPage:1},customData:null,afterTableRender:function(){},afterPaginationRender:function(){},errorLoad:function(a){i("数据加载出错！"+a)},extra:{},customAjax:function(b,c,d){a.ajax({type:"post",url:d.url,dataType:"json",data:b,success:function(a){c(a)},error:function(a,b){if(i(a),"parsererror"==b){var e=a.responseText;try{c(JSON.parse(e))}catch(f){try{var g=new Function("return "+e)();c(g)}catch(h){d.afterLoad(),d.errorLoad("解析数据异常！")}}}else d.afterLoad(),d.errorLoad(b)}})},isFullRow:!1,md5UniqueID:!1,beforeLoad:function(){},afterLoad:function(){}}});